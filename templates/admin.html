<!-- templates/admin.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de AdministraciÃ³n</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <h1>ğŸ› ï¸ Panel de AdministraciÃ³n</h1>
  <div class="admin-panel">

    <section>
      <h2>ğŸ“¥ INDEXACIÃ“N</h2>
      <p>ğŸ“… Ãšltima indexaciÃ³n: <strong>{{ ultima_indexacion }}</strong></p>

      <h3>ğŸŒ Fuentes de indexaciÃ³n</h3>
      <p><small>Formato sugerido por lÃ­nea: <code>https://dominio.com | tipo=sitemap | max_paginas=50</code></small></p>
      <textarea id="fuentes" rows="6" style="width:100%" placeholder="Una URL por lÃ­nea con parÃ¡metros opcionales como tipo=dominio, sitemap o pagina.">{{ fuentes_cargadas }}</textarea>
      <button onclick="guardarFuentes()">ğŸ’¾ Guardar fuentes</button>

      <h3>ğŸ§± Selectores HTML a extraer</h3>
      <textarea id="selectores" rows="4" style="width:100%" placeholder="Ej: p, h1, h2">{{ selectores_cargados }}</textarea>
      <button onclick="guardarSelectores()">ğŸ’¾ Guardar selectores</button>

      <h3>ğŸ“Š EstadÃ­sticas actuales</h3>
      <ul>
        <li>ğŸ”— URLs indexadas Ãºnicas: <strong>{{ total_urls }}</strong></li>
        <li>ğŸ“„ Fragmentos indexados: <strong>{{ total_fragmentos }}</strong></li>
        <li>ğŸ§­ URLs desde sitemaps: <strong>{{ total_urls_sitemap }}</strong></li>
        <li>ğŸ“ URLs directas: <strong>{{ total_urls_directas }}</strong></li>
      </ul>

      <button onclick="reindexar()">ğŸ”„ Reindexar contenido</button>
    </section>

    <hr>

    <section>
      <h2>ğŸ§  SELECCIÃ“N DE MODELO OPENAI</h2>
      <label for="modelo">ğŸ¤– Modelo actual:</label>
      <select id="modelo" onchange="cambiarModelo()">
        <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
        <option value="gpt-4">gpt-4</option>
      </select>
    </section>

    <div class="log" id="log"></div>

  </div>

  <script>
    async function reindexar() {
      document.getElementById("log").innerText = "Reindexando...";
      const res = await fetch("/api/reindexar", { method: "POST" });
      const data = await res.json();
      document.getElementById("log").innerText = data.mensaje;
    }

    async function cambiarModelo() {
      const modelo = document.getElementById("modelo").value;
      const res = await fetch("/api/modelo", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ modelo })
      });
      const data = await res.json();
      document.getElementById("log").innerText = data.mensaje;
    }

    async function guardarFuentes() {
      const contenido = document.getElementById("fuentes").value;
      const res = await fetch("/api/fuentes", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ fuentes: contenido })
      });
      const data = await res.json();
      document.getElementById("log").innerText = data.mensaje;
    }

    async function guardarSelectores() {
      const contenido = document.getElementById("selectores").value;
      const res = await fetch("/api/selectores", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ selectores: contenido })
      });
      const data = await res.json();
      document.getElementById("log").innerText = data.mensaje;
    }
  </script>
</body>
</html>
