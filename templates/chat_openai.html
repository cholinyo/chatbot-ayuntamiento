<!-- templates/chat_openai.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Comparativa RAG Local vs OpenAI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Comparativa RAG Local vs RAG+OpenAI</h1>
    <div id="chat-box"></div>
    <div id="input">
        <input type="text" id="pregunta" placeholder="Haz tu pregunta...">
        <button onclick="consultar()">Consultar</button>
    </div>

    <script>
        async function consultar() {
            const pregunta = document.getElementById("pregunta").value.trim();
            if (!pregunta) return;

            const box = document.getElementById("chat-box");
            box.innerHTML = "<p><em>Cargando respuestas...</em></p>";

            try {
                const [resLocal, resOpenAI] = await Promise.all([
                    fetch("/api/chat", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ pregunta })
                    }).then(res => res.ok ? res.json() : Promise.reject("RAG local fall√≥")),

                    fetch("/api/chat_openai", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ pregunta })
                    }).then(res => res.ok ? res.json() : Promise.reject("OpenAI fall√≥"))
                ]);

                box.innerHTML = "";

                // RAG Local
                const local = document.createElement("div");
                local.className = "respuesta local";
                local.innerHTML = `<div class='etiqueta'>üß† RAG Local</div><div>${resLocal.respuesta}</div>`;
                if (resLocal.fragmentos && resLocal.fragmentos.length > 0) {
                    const detallesLocal = document.createElement("details");
                    detallesLocal.className = "contexto";
                    detallesLocal.innerHTML = `<summary>üìÑ Fragmentos usados (RAG Local)</summary><pre>${resLocal.fragmentos.join("\n\n---\n\n")}</pre>`;
                    local.appendChild(detallesLocal);
                }
                box.appendChild(local);

                // RAG + OpenAI
                const openai = document.createElement("div");
                openai.className = "respuesta openai";
                openai.innerHTML = `<div class='etiqueta'>‚ú® RAG + OpenAI</div><div>${resOpenAI.respuesta}</div>`;
                if (resOpenAI.fragmentos && resOpenAI.fragmentos.length > 0) {
                    const detallesOpen = document.createElement("details");
                    detallesOpen.className = "contexto";
                    detallesOpen.innerHTML = `<summary>üìö Fragmentos usados (RAG + OpenAI)</summary><pre>${resOpenAI.fragmentos.join("\n\n---\n\n")}</pre>`;
                    openai.appendChild(detallesOpen);
                }
                box.appendChild(openai);

            } catch (error) {
                box.innerHTML = `<p style="color: red;">‚ùå Error al recuperar respuestas: ${error}</p>`;
                console.error("‚ùå Error en fetch:", error);
            }
        }

        document.getElementById("pregunta").addEventListener("keydown", function(e) {
            if (e.key === "Enter") consultar();
        });
    </script>
</body>
</html>
